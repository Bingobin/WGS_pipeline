# WGS_pipeline
## DNA sequence alignment and data quality assessment 
Raw reads were aligned to the reference human genome hg38 (Genome Reference Consortium GRCh38) using BWA 0.7.17-r1188 (Burrows–Wheeler Aligner) MEM algorithm with default parameters[1]. For datasets with multiple lanes of data (Table 1 and Table 2), these were aligned independently for each lane and merged using Picard(https://github.com/broadinstitute/picard/) ‘MergeSamFiles’ version 25.0 with default parameters. Duplicate reads were marked with Picard ‘MarkDuplicates’ version 25.0 with default parameters. Local realignment around indels and base quality score recalibration were performed using GATK (Genome Analysis ToolKit) version 3.8 (https://software.broadinstitute.org/gatk/). Quality of the alignments was assessed by metrics determined by Samtools stats (version 1.6)[2], FastQC(http://www.bioinformatics.babraham.ac.uk/projects/fastqc/), and coverage and depth of alignments were assessed though each base depth calculated by Samtools depth (version 1.6). The mean depth of all the samples was 52X. Detailed statistics on alignment and coverage are given in Table 3.

## Whole genomic somatic SNVs and small InDels analysis 
Somatic SNVs and small indels were called with Mutect2 (one tool of GATK 3.8.0 and this caller combines the DREAM challenge-winning somatic genotyping engine of the original MuTect[3] with the assembly-based machinery of HaplotypeCaller), VarScan2 2.4.1[4] and VarDict 1.5.1[5]. At the same time, we added two other software to call snv, which are SomaticSniper 1.0.5.0[6] and MuSE 1.0[7]. Each of these variant callers was run using default parameters or according to those recommended by the authors where available. After variant calling, the filtering was performed as following criteria: (a) at least 1% of variant allele support must come from reads sequenced on each strand, (b) the variants whose allele frequency in the tumor sample must be at least 10%, (c)the variants whose allele frequency in the normal sample was at most 5%, (d) there must be at least 4 variant supporting reads, (e)the total number of variant and reference reads must be less than 200 and more than 20. The SNVs and InDels, which were called by mutect2, were conserved that annotated as PASS in the FILTER field. Then, the somatic InDels that do not overlap with the varscan and vardict results were further filtered. In the end, we produced a variant list that contained high-confidence SNVs and InDels. 

Each somatic variant was annotated using Annovar [8]. In this study, Somatic variants were divided into four tiers based on the result of annotation (Table 4). Tier 1: Changes in the amino acid coding regions of annotated exons, consensus splice-site regions, and RNA genes (including microRNAs). Tier 2: Changes in highly conserved regions of the genome or regions with regulatory potential.  Tier 3: Changes in the nonrepetitive part of the genome that do not meet the criteria for tier 2.  Tier 4: Changes in the remainder of the genome.[9] Then, the high quality somatic variants were used for analysis of the clonal architecture of the primary tumor and its evolution from primary to relapse. VAFs were calculated by combining read depth from all datasets. Subclone identity (clones 1-3) was predicted by use of SciClone[10]. 

## Fusion gene detection analysis
Fusion genes were detected using WGS data and RNAseq data, simultaneously. At first, larger structure variants were identified by Manta[11] and Lumpy[12] with default parameters at the genome-wide level. The hair follicle sample was served as a normal control (NC) to exclude potential germline variants. Variants were annotated using Annovar. The variants annotated as PASS in FILTER field was extracted, and variants of the translocation were retained for further analysis. If the breakpoints of the translocate variants were distributed in the intergenic region, we would further filter out these variants. Manta produced a results list containing 5 candidate fusion genes in primary sample and 13 in relapsed sample, and Lumpy produced a results list containing 46 candidate fusion genes in primary sample and 44 in relapsed sample. Then, we used the software Soapfuse[13] to identify fusion genes at the transcriptome level. After filtering out the fusion genes that the breakpoints were distributed in the intergenic region, the results list contains 22 and 86 candidate fusion genes in primary sample and relapsed sample, respectively. Finally, we intersect the results of the three software. It was found that only the PML-RAR fusion gene was verified in the primary sample, but the PML-RARA fusion gene was not present in the relapsed sample, and the new fusion gene MLL-USO1 was found in relapsed sample.
